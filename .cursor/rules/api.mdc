---
description: API
alwaysApply: false
---

# ğŸ“š å›¾åºŠé¡¹ç›® API æ–‡æ¡£

æœ¬æ–‡æ¡£æè¿° **å›¾åºŠåç«¯æœåŠ¡** çš„ RESTful APIï¼Œè´Ÿè´£å›¾ç‰‡ä¸Šä¼ ã€å­˜å‚¨ã€æ ‡ç­¾ç®¡ç†ã€æœç´¢ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

## å›¾åºŠåç«¯æœåŠ¡ API

### A. å›¾ç‰‡ç®¡ç† (Image Management)

#### 1\. ä¸Šä¼ å›¾ç‰‡

| æ–¹æ³• | è·¯å¾„ | æè¿° |
| :--- | :--- | :--- |
| `POST` | `/images/upload` | ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼Œå¯é€‰æ·»åŠ æè¿°ï¼Œè¿”å›å›¾ç‰‡ URLã€‚ |

| å‚æ•° | ä½ç½® | ç±»å‹ | æè¿° | å¿…å¡« |
| :--- | :--- | :--- | :--- | :--- |
| `file` | Body (FormData) | File | è¦ä¸Šä¼ çš„å›¾ç‰‡æ–‡ä»¶ã€‚ | æ˜¯ |
| `description` | Body (FormData) | String | å›¾ç‰‡æè¿°ä¿¡æ¯ã€‚ | å¦ |

**æˆåŠŸå“åº” (201 Created):**

```json
{
  "code": 201,
  "message": "Upload successful",
  "data": {
    "image_id": "img_a1b2c3d4",
    "url": "https://cdn.your-imagehost.com/a1b2c3d4.jpg",
    "hash": "e6884675b87...",
    "description": "ç¾ä¸½çš„é£æ™¯ç…§ç‰‡"
  }
}
```

#### 2\. æ‰¹é‡ä¸Šä¼ å›¾ç‰‡

| æ–¹æ³• | è·¯å¾„ | æè¿° |
| :--- | :--- | :--- |
| `POST` | `/images/batch-upload` | æ‰¹é‡ä¸Šä¼ å¤šä¸ªå›¾ç‰‡æ–‡ä»¶ï¼Œè¿”å›æ¯ä¸ªæ–‡ä»¶çš„ä¸Šä¼ ç»“æœã€‚ |

| å‚æ•° | ä½ç½® | ç±»å‹ | æè¿° | å¿…å¡« |
| :--- | :--- | :--- | :--- | :--- |
| `files` | Body (FormData) | File[] | è¦ä¸Šä¼ çš„å›¾ç‰‡æ–‡ä»¶æ•°ç»„ã€‚ | æ˜¯ |

**è¯´æ˜**ï¼š
- æ‰¹é‡ä¸Šä¼ ä¸æ”¯æŒæ·»åŠ  tag å’Œ descriptionï¼Œè¿™äº›ä¿¡æ¯å¯ä»¥åœ¨ä¸Šä¼ åé€šè¿‡å…¶ä»–æ¥å£ä¿®æ”¹
- æ¯ä¸ªæ–‡ä»¶ç‹¬ç«‹å¤„ç†ï¼Œéƒ¨åˆ†å¤±è´¥ä¸å½±å“å…¶ä»–æ–‡ä»¶
- å»ºè®®å•æ¬¡æ‰¹é‡ä¸Šä¼ ä¸è¶…è¿‡ 20 ä¸ªæ–‡ä»¶

**æˆåŠŸå“åº” (200 OK):**

```json
{
  "code": 200,
  "message": "Batch upload completed",
  "data": {
    "total": 5,
    "success": 4,
    "failed": 1,
    "results": [
      {
        "filename": "photo1.jpg",
        "status": "success",
        "image_id": "img_a1b2c3d4",
        "url": "https://cdn.your-imagehost.com/a1b2c3d4.jpg",
        "hash": "e6884675b87..."
      },
      {
        "filename": "photo2.jpg",
        "status": "success",
        "image_id": "img_b2c3d4e5",
        "url": "https://cdn.your-imagehost.com/b2c3d4e5.jpg",
        "hash": "f7995786c98..."
      },
      {
        "filename": "invalid.txt",
        "status": "failed",
        "error": "Invalid file type"
      }
    ]
  }
}
```

#### 3\. åˆ—å‡ºæ‰€æœ‰å›¾ç‰‡

| æ–¹æ³• | è·¯å¾„ | æè¿° |
| :--- | :--- | :--- |
| `GET` | `/images` | è·å–æ‰€æœ‰å›¾ç‰‡åˆ—è¡¨ï¼Œæ”¯æŒåˆ†é¡µã€‚ |

| å‚æ•° | ä½ç½® | ç±»å‹ | æè¿° | å¿…å¡« |
| :--- | :--- | :--- | :--- | :--- |
| `page` | Query | Integer | é¡µç ï¼ˆä» 1 å¼€å§‹ï¼‰ã€‚ | å¦ (é»˜è®¤ 1) |
| `limit` | Query | Integer | æ¯é¡µæ•°é‡ã€‚ | å¦ (é»˜è®¤ 20) |
| `sort` | Query | String | æ’åºæ–¹å¼ï¼š`date_desc` (æœ€æ–°ä¼˜å…ˆ) æˆ– `date_asc` (æœ€æ—§ä¼˜å…ˆ)ã€‚ | å¦ (é»˜è®¤ date_desc) |

**æˆåŠŸå“åº” (200 OK):**

```json
{
  "code": 200,
  "message": "Success",
  "data": {
    "total": 150,
    "current_page": 1,
    "images": [
      {
        "id": "img_a1b2c3d4",
        "url": "https://cdn.your-imagehost.com/a1b2c3d4.jpg",
        "description": "ç¾ä¸½çš„é£æ™¯ç…§ç‰‡",
        "upload_date": "2025-10-26T12:00:00Z",
        "tags": ["é£æ™¯", "è‡ªç„¶"]
      }
    ]
  }
}
```

#### 4\. è·å–å›¾ç‰‡è¯¦æƒ…

| æ–¹æ³• | è·¯å¾„ | æè¿° |
| :--- | :--- | :--- |
| `GET` | `/images/{image_id}` | è·å–å•å¼ å›¾ç‰‡çš„å®Œæ•´ä¿¡æ¯ï¼ŒåŒ…æ‹¬ URLã€æè¿°ã€æ ‡ç­¾ç­‰å…ƒæ•°æ®ã€‚ |

**æˆåŠŸå“åº” (200 OK):**

```json
{
  "code": 200,
  "message": "Success",
  "data": {
    "image_id": "img_a1b2c3d4",
    "url": "https://cdn.your-imagehost.com/a1b2c3d4.jpg",
    "hash": "e6884675b87...",
    "description": "ç¾ä¸½çš„é£æ™¯ç…§ç‰‡",
    "upload_date": "2025-10-26T12:00:00Z",
    "tags": ["é£æ™¯", "è‡ªç„¶"]
  }
}
```

#### 5\. æ›´æ–°å›¾ç‰‡æè¿°

| æ–¹æ³• | è·¯å¾„ | æè¿° |
| :--- | :--- | :--- |
| `PUT` | `/images/{image_id}` | æ›´æ–°å›¾ç‰‡çš„æè¿°ä¿¡æ¯ã€‚ |

| å‚æ•° | ä½ç½® | ç±»å‹ | æè¿° | å¿…å¡« |
| :--- | :--- | :--- | :--- | :--- |
| `description` | Body | String | æ–°çš„å›¾ç‰‡æè¿°ã€‚ | æ˜¯ |

**æˆåŠŸå“åº” (200 OK):**

```json
{
  "code": 200,
  "message": "Description updated successfully"
}
```

#### 6\. åˆ é™¤å›¾ç‰‡

| æ–¹æ³• | è·¯å¾„ | æè¿° |
| :--- | :--- | :--- |
| `DELETE` | `/images/{image_id}` | æ ¹æ® ID åˆ é™¤å›¾ç‰‡ï¼ˆè½¯åˆ é™¤ï¼‰ã€‚ |

**æˆåŠŸå“åº” (200 OK):**

```json
{
  "code": 200,
  "message": "Image deleted successfully"
}
```

---

#### 7\. æ‰¹é‡åˆ é™¤å›¾ç‰‡

| æ–¹æ³• | è·¯å¾„ | æè¿° |
| :--- | :--- | :--- |
| `POST` | `/images/batch-delete` | æ‰¹é‡åˆ é™¤å¤šå¼ å›¾ç‰‡ï¼ˆè½¯åˆ é™¤ï¼‰ã€‚ |

| å‚æ•° | ä½ç½® | ç±»å‹ | æè¿° | å¿…å¡« |
| :--- | :--- | :--- | :--- | :--- |
| `image_ids` | Body | String Array | è¦åˆ é™¤çš„å›¾ç‰‡ ID åˆ—è¡¨ã€‚ | æ˜¯ |

**è¯·æ±‚ç¤ºä¾‹**

```json
{
  "image_ids": ["img_a1b2c3d4", "img_b2c3d4e5", "img_c3d4e5f6"]
}
```

**æˆåŠŸå“åº” (200 OK):**

```json
{
  "code": 200,
  "message": "Batch delete completed",
  "data": {
    "total": 3,
    "success": 2,
    "failed": 1,
    "results": [
      {
        "image_id": "img_a1b2c3d4",
        "status": "success"
      },
      {
        "image_id": "img_b2c3d4e5",
        "status": "success"
      },
      {
        "image_id": "img_c3d4e5f6",
        "status": "failed",
        "error": "Image not found"
      }
    ]
  }
}
```

---

### B. æ ‡ç­¾ç®¡ç†ä¸æŸ¥è¯¢ (Tag Management & Query)

#### 8\. ç»™å›¾ç‰‡æ‰“æ ‡ç­¾

| æ–¹æ³• | è·¯å¾„ | æè¿° |
| :--- | :--- | :--- |
| `PUT` | `/images/{image_id}/tags` | æ›´æ–°å›¾ç‰‡çš„æ ‡ç­¾ã€‚ |

| å‚æ•° | ä½ç½® | ç±»å‹ | æè¿° | å¿…å¡« |
| :--- | :--- | :--- | :--- | :--- |
| `tags` | Body | String Array | æ–°çš„æ ‡ç­¾åˆ—è¡¨ã€‚ | æ˜¯ |
| `mode` | Body | String | **'set'** (æ›¿æ¢æ‰€æœ‰æ ‡ç­¾) æˆ– **'append'** (è¿½åŠ æ–°æ ‡ç­¾)ã€‚ | å¦ (é»˜è®¤'set') |

#### 9\. AI ç”Ÿæˆå›¾ç‰‡æè¿°å’Œæ ‡ç­¾

| æ–¹æ³• | è·¯å¾„ | æè¿° |
| :--- | :--- | :--- |
| `POST` | `/images/{image_id}/tags/generate` | ä½¿ç”¨å¤šæ¨¡æ€å¤§è¯­è¨€æ¨¡å‹è‡ªåŠ¨ä¸ºå›¾ç‰‡ç”Ÿæˆæè¿°å’Œæ ‡ç­¾ã€‚ |

| å‚æ•° | ä½ç½® | ç±»å‹ | æè¿° | å¿…å¡« |
| :--- | :--- | :--- | :--- | :--- |
| `image_id` | Path | String | å›¾ç‰‡ IDã€‚ | æ˜¯ |
| `prompt` | Body | String | æç¤ºè¯ï¼Œå¼•å¯¼ LLM ç”Ÿæˆæè¿°å’Œæ ‡ç­¾ï¼ˆå¯åœ¨æç¤ºè¯ä¸­æ§åˆ¶æ•°é‡ã€è¯­è¨€ã€é£æ ¼ç­‰ï¼‰ã€‚ | å¦ |

**è¯´æ˜**ï¼š
- è°ƒç”¨å¤šæ¨¡æ€å¤§è¯­è¨€æ¨¡å‹ï¼ˆå¦‚ Doubao Seedï¼‰åˆ†æå›¾ç‰‡å†…å®¹
- æ ¹æ®å›¾ç‰‡å†…å®¹å’Œæç¤ºè¯è‡ªåŠ¨ç”Ÿæˆæè¿°å’Œæ ‡ç­¾
- `prompt` ä¸ºç©ºæ—¶ä½¿ç”¨é»˜è®¤æç¤ºè¯
- LLM è¿”å› JSON æ ¼å¼ç»“æœï¼š`{"description": "...", "tags": ["tag1", "tag2", ...]}`
- å‰ç«¯å¯ä»¥é€‰æ‹©æ€§åœ°ä½¿ç”¨æˆ–ä¿®æ”¹è¿”å›çš„æè¿°å’Œæ ‡ç­¾
- åç«¯ä¸è‡ªåŠ¨ä¿å­˜ï¼Œç”±å‰ç«¯å†³å®šæ˜¯å¦åº”ç”¨
- **å‰ç«¯è¡Œä¸º**ï¼šæè¿°ä¼š**ç›´æ¥è¦†ç›–**ç°æœ‰æè¿°ï¼Œæ ‡ç­¾ä¼š**è¿½åŠ **åˆ°ç°æœ‰æ ‡ç­¾åˆ—è¡¨

**é»˜è®¤æç¤ºè¯**ï¼š
```
è¯·åˆ†æè¿™å¼ å›¾ç‰‡ï¼Œä¸ºå®ƒç”Ÿæˆä¸€ä¸ªç®€æ´çš„æè¿°ï¼ˆ20-50å­—ï¼‰å’Œ 5-10 ä¸ªæè¿°æ€§æ ‡ç­¾ã€‚
æ ‡ç­¾åº”å‡†ç¡®ã€ç®€æ´ï¼Œæ¶µç›–ï¼šä¸»é¢˜ã€åœºæ™¯ã€é£æ ¼ã€è‰²å½©ã€æƒ…æ„Ÿç­‰æ–¹é¢ã€‚
```

**è¯·æ±‚ç¤ºä¾‹ 1ï¼ˆä½¿ç”¨é»˜è®¤æç¤ºè¯ï¼‰**ï¼š
```json
{
  "prompt": ""
}
```

**è¯·æ±‚ç¤ºä¾‹ 2ï¼ˆè‡ªå®šä¹‰ä¸­æ–‡é£æ ¼ï¼‰**ï¼š
```json
{
  "prompt": "è¯·ç”¨è¯—æ„çš„è¯­è¨€æè¿°è¿™å¼ å›¾ç‰‡ï¼ˆ30å­—ä»¥å†…ï¼‰ï¼Œå¹¶ç”Ÿæˆ 8 ä¸ªæ–‡è‰ºé£æ ¼çš„ä¸­æ–‡æ ‡ç­¾"
}
```

**è¯·æ±‚ç¤ºä¾‹ 3ï¼ˆç”Ÿæˆè‹±æ–‡å†…å®¹ï¼‰**ï¼š
```json
{
  "prompt": "Generate a concise English description (20-40 words) and 10 English tags for this image. Focus on subject, style, colors, and mood."
}
```

**è¯·æ±‚ç¤ºä¾‹ 4ï¼ˆä¸“ä¸šæ‘„å½±é£æ ¼ï¼‰**ï¼š
```json
{
  "prompt": "ç”¨ä¸“ä¸šæ‘„å½±æœ¯è¯­æè¿°è¿™å¼ ç…§ç‰‡ï¼ˆ30å­—ï¼‰ï¼Œå¹¶ç”Ÿæˆ 6 ä¸ªæ‘„å½±æŠ€æœ¯ç›¸å…³çš„æ ‡ç­¾ï¼ˆå¦‚æ„å›¾ã€å…‰çº¿ã€æ™¯æ·±ç­‰ï¼‰"
}
```

**æˆåŠŸå“åº” (200 OK):**

```json
{
  "code": 200,
  "message": "Image info generated successfully",
  "data": {
    "generated_description": "æ—¥è½æ—¶åˆ†çš„ç¾¤å±±å‰ªå½±ï¼Œæ©™çº¢è‰²çš„å¤©ç©ºæ˜ è¡¬ç€è¿ç»µèµ·ä¼çš„å±±è„‰ï¼Œè¥é€ å‡ºå®é™è€Œå£®ç¾çš„è‡ªç„¶æ™¯è§‚ã€‚",
    "generated_tags": ["é£æ™¯", "å±±å·", "æ—¥è½", "è‡ªç„¶", "å®é™", "æ©™è‰²", "æˆ·å¤–", "å‰ªå½±"]
  }
}
```

**å“åº”å­—æ®µè¯´æ˜**ï¼š
- `generated_description`: AI ç”Ÿæˆçš„å›¾ç‰‡æè¿°
- `generated_tags`: AI ç”Ÿæˆçš„æ ‡ç­¾åˆ—è¡¨

**é”™è¯¯å“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 503,
  "message": "LLM service error: failed to parse JSON response"
}
```

**ä½¿ç”¨åœºæ™¯**ï¼š
1. **å¿«é€Ÿæ ‡æ³¨**ï¼šä½¿ç”¨é»˜è®¤æç¤ºè¯ä¸€é”®ç”Ÿæˆä¸­æ–‡æè¿°å’Œæ ‡ç­¾
2. **å®šåˆ¶åŒ–é£æ ¼**ï¼šè‡ªå®šä¹‰ prompt ç”Ÿæˆç‰¹å®šé£æ ¼çš„å†…å®¹
3. **å¤šè¯­è¨€æ”¯æŒ**ï¼šåœ¨ prompt ä¸­æŒ‡å®šè¯­è¨€ï¼ˆä¸­æ–‡ã€è‹±æ–‡ã€æ—¥æ–‡ç­‰ï¼‰
4. **ä¸“ä¸šé¢†åŸŸ**ï¼šé€šè¿‡ prompt å¼•å¯¼ç”Ÿæˆä¸“ä¸šé¢†åŸŸçš„å†…å®¹ï¼ˆæ‘„å½±ã€è‰ºæœ¯ã€æŠ€æœ¯ç­‰ï¼‰
5. **æ‰¹é‡å¤„ç†**ï¼šå‰ç«¯å¯ä»¥æ‰¹é‡è°ƒç”¨æ­¤æ¥å£ä¸ºå¤šå¼ å›¾ç‰‡ç”Ÿæˆä¿¡æ¯
6. **é‡æ–°ç”Ÿæˆæè¿°**ï¼šå¤šæ¬¡è°ƒç”¨ä¼šè¦†ç›–ä¹‹å‰çš„æè¿°ï¼Œæ ‡ç­¾ä¼šç´¯ç§¯

---

#### 10\. åˆ—å‡ºæ‰€æœ‰æ ‡ç­¾

| æ–¹æ³• | è·¯å¾„ | æè¿° |
| :--- | :--- | :--- |
| `GET` | `/tags` | è·å–æ‰€æœ‰å·²ç”¨æ ‡ç­¾åˆ—è¡¨ã€‚ **(åˆ†é¡µå¿…é¡»)** |

| å‚æ•° | ä½ç½® | ç±»å‹ | æè¿° | å¿…å¡« |
| :--- | :--- | :--- | :--- | :--- |
| `page` | Query | Integer | é¡µç  (ä» 1 å¼€å§‹)ã€‚ | å¦ (é»˜è®¤ 1) |
| `limit` | Query | Integer | æ¯é¡µæ•°é‡ã€‚ | å¦ (é»˜è®¤ 50) |

**æˆåŠŸå“åº”:**

```json
{
  "code": 200,
  "message": "Success",
  "data": {
    "total": 1250,
    "current_page": 1,
    "tags": [
      {"name": "é£æ™¯", "count": 520}, 
      {"name": "çŒ«å’ª", "count": 480}, 
      {"name": "è‰ºæœ¯", "count": 300}
    ]
  }
}
```

#### 11\. ç²¾ç¡®æœç´¢ï¼ˆAND é€»è¾‘ï¼‰

| æ–¹æ³• | è·¯å¾„ | æè¿° |
| :--- | :--- | :--- |
| `GET` | `/search/exact` | ä¸¥æ ¼ AND æœç´¢ï¼Œåªè¿”å›åŒæ—¶åŒ…å«æ‰€æœ‰æŒ‡å®šæ ‡ç­¾çš„å›¾ç‰‡ã€‚ |

| å‚æ•° | ä½ç½® | ç±»å‹ | æè¿° | å¿…å¡« |
| :--- | :--- | :--- | :--- | :--- |
| `tags` | Query | String Array | å¿…é¡»åŒ…å«çš„æ ‡ç­¾åˆ—è¡¨ (e.g., `tags=cat,cute`)ã€‚ | æ˜¯ |
| `page`, `limit` | Query | Integer | åˆ†é¡µå‚æ•°ã€‚ | å¦ |

**æˆåŠŸå“åº”:**

```json
{
  "code": 200,
  "message": "Success",
  "data": {
    "total": 150,
    "current_page": 1,
    "results": [
      {
        "id": "img_x1y2z3a4",
        "url": "https://cdn.your-imagehost.com/x1y2z3a4.jpg",
        "description": "ç¾ä¸½çš„å±±å·é£æ™¯",
        "tags": ["é£æ™¯", "è‡ªç„¶", "å±±å·"]
      }
    ]
  }
}
```

#### 12\. ç›¸å…³æ€§æœç´¢ï¼ˆOR é€»è¾‘ï¼‰

| æ–¹æ³• | è·¯å¾„ | æè¿° |
| :--- | :--- | :--- |
| `GET` | `/search/relevance` | OR é€»è¾‘æœç´¢ï¼Œè¿”å›åŒ…å«ä»»ä¸€æ ‡ç­¾çš„å›¾ç‰‡ï¼ŒæŒ‰åŒ¹é…æ ‡ç­¾æ•°é™åºæ’åˆ—ã€‚ |

| å‚æ•° | ä½ç½® | ç±»å‹ | æè¿° | å¿…å¡« |
| :--- | :--- | :--- | :--- | :--- |
| `tags` | Query | String Array | æ ‡ç­¾åˆ—è¡¨ (e.g., `tags=cat,cute`)ã€‚ | æ˜¯ |
| `page`, `limit` | Query | Integer | åˆ†é¡µå‚æ•°ã€‚ | å¦ |

**æˆåŠŸå“åº”:**

```json
{
  "code": 200,
  "message": "Success",
  "data": {
    "total": 520,
    "current_page": 1,
    "results": [
      {
        "id": "img_x1y2z3a4",
        "url": "https://cdn.your-imagehost.com/x1y2z3a4.jpg",
        "description": "å¯çˆ±çš„çŒ«å’ª",
        "matched_tag_count": 3,
        "tags": ["cat", "cute", "pet"]
      },
      {
        "id": "img_b5c6d7e8",
        "url": "https://cdn.your-imagehost.com/b5c6d7e8.jpg",
        "description": "åŠ¨ç‰©ç…§ç‰‡",
        "matched_tag_count": 2,
        "tags": ["cat", "animal"]
      }
    ]
  }
}
```
